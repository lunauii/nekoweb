---
import BGCircles from "../components/BGCircles.astro";

const { targetDay = 2, targetTime = "15:00:00" } = Astro.props;
---
<div class="timer-container">
  <div class="timer-card">
    <p class="label">This week's class ends in:</p>
    
    <div id="timer" class="timer-display">
      <div class="time-segment"><span id="days">00</span></div>:
      <div class="time-segment"><span id="hours">00</span></div>:
      <div class="time-segment"><span id="minutes">00</span></div>:
      <div class="time-segment"><span id="seconds">00</span></div>
    </div>

    <p id="rest-message" class="rest-message hidden">have a good rest of the week! :D</p>

    <div class="action-area">
      <a href="#" class="placeholder-link">bible: the third</a>
    </div>
  </div>
</div>

<BGCircles></BGCircles>

<script src="../scripts/oneko.js"></script>

<script define:vars={{ targetDay, targetTime }}>
  function updateTimer() {
    const now = new Date();
    const [tHours, tMinutes, tSeconds] = targetTime.split(':').map(Number);
    
    let target = new Date();
    target.setHours(tHours, tMinutes, tSeconds, 0);
    let daysUntilTarget = (targetDay - now.getDay() + 7) % 7;
    if (daysUntilTarget === 0 && now >= target) daysUntilTarget = 7;
    target.setDate(now.getDate() + daysUntilTarget);

    let reset = new Date();
    reset.setHours(0, 0, 0, 0);
    let daysUntilReset = (1 - now.getDay() + 7) % 7; 
    if (daysUntilReset === 0 && now >= reset) daysUntilReset = 7;
    reset.setDate(now.getDate() + daysUntilReset);

    const timerEl = document.getElementById('timer');
    const msgEl = document.getElementById('rest-message');
    
    let d = 0, h = 0, m = 0, s = 0;

    if (reset < target) {
      timerEl.classList.add('darkened');
      msgEl.classList.remove('hidden');
    } else {
      timerEl.classList.remove('darkened');
      msgEl.classList.add('hidden');
      
      const diff = target - now;
      d = Math.floor(diff / (1000 * 60 * 60 * 24));
      h = Math.floor((diff / (1000 * 60 * 60)) % 24);
      m = Math.floor((diff / (1000 * 60)) % 60);
      s = Math.floor((diff / 1000) % 60);
    }

    document.getElementById('days').innerText = d.toString().padStart(2, '0');
    document.getElementById('hours').innerText = h.toString().padStart(2, '0');
    document.getElementById('minutes').innerText = m.toString().padStart(2, '0');
    document.getElementById('seconds').innerText = s.toString().padStart(2, '0');
  }

  updateTimer();
  setInterval(updateTimer, 1000);
</script>

<style>
  html {
      background:#312235;
  }

  .timer-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    width: 100%;
    background-color: #312235;
    margin: 0;
  }

  .timer-card {
    text-align: center;
    padding: 2rem;
    border-radius: 1rem;
    border: 2px #9E7EA6 dashed;
    background-color: #362938;
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
  }

  .label {
    letter-spacing: 0.1em;
    font-size: 0.875rem;
    color: #b094b8;
  }

  .timer-display {
    font-family: 'Courier New', monospace;
    font-size: 4rem; 
    font-weight: 700;
    color: #CAA8CD;
    display: flex;
    gap: 1rem;
    transition: all 0.3s ease;
    background: linear-gradient(
      to bottom,
      #fcfaff 0%,
      #CAA8CD 45%,
      #8c6a8f 80%,
      #CAA8CD 100%
    );
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .timer-display.darkened {
    opacity: 0.4;
    background: #CAA8CD;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .rest-message {
    color: #CAA8CD;
    font-family: 'Courier New', monospace;
    margin: 0;
    font-size: 1rem;
  }

  .hidden {
    display: none;
  }

  .time-segment {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .action-area {
    margin-top: 1rem;
  }

  .placeholder-link {
    display: inline-block;
    color: #9E7EA6;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.2s ease;
    border: 2px solid #9E7EA6;
    padding: 0.5rem 1.5rem;
    border-radius: 9999px;
  }

  .placeholder-link:hover {
    background-color: #9E7EA6;
    color: #200f2a;
    transform: translateY(-2px);
  }
</style>